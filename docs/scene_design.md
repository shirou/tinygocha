# シーン設計

## シーン構成概要

デモ版でも完全なゲーム体験を提供するため、以下のシーンを実装する。

## 必要なシーン

### 1. タイトル画面 (Title Scene)
**目的**: ゲーム開始とブランディング

**要素**:
- ゲームタイトル「ゴチャキャラバトル」表示
- 「戦闘開始」ボタン
- 「終了」ボタン
- 背景画像（簡易版）

**遷移**:
- 戦闘開始 → 軍勢設定画面
- 終了 → アプリケーション終了

### 2. 軍勢設定画面 (Army Setup Scene)
**目的**: 戦闘前の軍勢カスタマイズ

**要素**:
- **ステージ選択セクション**
  - 利用可能なステージ一覧
  - ステージ詳細情報（地形、効果）
  
- **軍勢A設定セクション**
  - グループ数選択（1-10個）
  - 各グループ設定：
    - リーダーユニット選択
    - 一般兵の種類選択
    - 一般兵の数選択（1-9人）
  
- **軍勢B設定セクション**
  - 軍勢Aと同様の設定
  
- **プリセット機能**
  - デモ用事前定義軍勢
  - 「バランス型」「攻撃重視」「防御重視」など
  
- **操作ボタン**
  - 「戦闘開始」ボタン
  - 「戻る」ボタン

**遷移**:
- 戦闘開始 → 配置画面
- 戻る → タイトル画面

### 3. 配置画面 (Deployment Scene)
**目的**: 戦術的な初期配置

**要素**:
- **ステージ表示**
  - 選択されたステージの地形表示
  - 配置ポイントの可視化
  - 地形効果の表示
  
- **配置システム**
  - グループ単位での配置
  - ドラッグ&ドロップ操作
  - 配置可能エリアのハイライト
  
- **配置順序**
  - 軍勢A → 軍勢B の順番で配置
  - 現在の配置ターン表示
  
- **UI要素**
  - 配置済みグループ一覧
  - 「配置完了」ボタン
  - 「やり直し」ボタン

**遷移**:
- 配置完了 → 戦闘画面
- やり直し → 軍勢設定画面

### 4. 戦闘画面 (Battle Scene)
**目的**: メインゲームプレイ

**要素**:
- **メインビューポート**
  - ユニット表示・アニメーション
  - 地形表示
  - 攻撃エフェクト
  - ダメージ表示
  
- **UI要素**
  - 残り時間表示
  - 軍勢A戦力ゲージ
  - 軍勢B戦力ゲージ
  - ミニマップ（簡易版）
  - 「一時停止」ボタン
  
- **情報表示**
  - 選択ユニットの詳細情報
  - 戦闘ログ（簡易版）

**遷移**:
- 戦闘終了 → 結果画面
- 一時停止 → ポーズメニュー

### 5. 結果画面 (Result Scene)
**目的**: 戦闘結果の表示と次のアクション

**要素**:
- **勝敗表示**
  - 勝利軍勢の表示
  - 勝利条件の説明
  
- **戦闘統計**
  - 各軍勢の生存ユニット数
  - 与えたダメージ総量
  - 戦闘時間
  - MVP（最も活躍したユニット）
  
- **操作ボタン**
  - 「再戦」ボタン（同じ設定で再戦）
  - 「軍勢変更」ボタン（設定画面に戻る）
  - 「タイトルに戻る」ボタン

**遷移**:
- 再戦 → 配置画面
- 軍勢変更 → 軍勢設定画面
- タイトルに戻る → タイトル画面

## シーン管理システム

### SceneManager構造
```go
type SceneType int

const (
    SceneTitle SceneType = iota
    SceneArmySetup
    SceneDeployment
    SceneBattle
    SceneResult
    ScenePause  // 一時停止画面
)

type Scene interface {
    Update() error
    Draw(screen *ebiten.Image)
    HandleInput(input *InputState)
    OnEnter(data interface{})
    OnExit()
}

type SceneManager struct {
    currentScene SceneType
    scenes       map[SceneType]Scene
    gameData     *GameData
    transition   *SceneTransition
}

type GameData struct {
    SelectedStage    *Stage
    ArmyA           *ArmyConfig
    ArmyB           *ArmyConfig
    BattleResult    *BattleResult
    Settings        *GameSettings
}
```

### シーン遷移システム
```go
type SceneTransition struct {
    isTransitioning bool
    fromScene      SceneType
    toScene        SceneType
    progress       float64
    duration       float64
}

func (sm *SceneManager) TransitionTo(scene SceneType, data interface{}) {
    // フェードイン・フェードアウト効果付きの遷移
}
```

## 実装優先順位

### Phase 1 (MVP)
1. **タイトル画面**
   - 基本的な表示とボタン
   - シーン遷移システムの基盤
   
2. **簡易軍勢設定画面**
   - プリセット軍勢選択のみ
   - 基本的なUI要素
   
3. **戦闘画面**
   - メインゲームプレイ機能
   - 基本的なUI表示
   
4. **結果画面**
   - 勝敗表示
   - 基本的な統計情報

### Phase 2 (機能拡張)
1. **配置画面**
   - 戦術的配置システム
   - ドラッグ&ドロップ操作
   
2. **詳細軍勢設定**
   - カスタム軍勢作成
   - 詳細なユニット選択
   
3. **UI改善**
   - アニメーション効果
   - 詳細な情報表示
   - ミニマップ

### Phase 3 (ポリッシュ)
1. **視覚効果**
   - シーン遷移アニメーション
   - パーティクル効果
   
2. **音響効果**
   - BGM
   - 効果音
   
3. **ユーザビリティ**
   - キーボードショートカット
   - 設定保存機能

## 技術的考慮事項

### メモリ管理
- シーン切り替え時のリソース解放
- 大きなアセットの遅延読み込み

### 状態管理
- シーン間でのデータ受け渡し
- ゲーム設定の永続化

### エラーハンドリング
- シーン遷移時のエラー処理
- 不正な状態からの復旧
